<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII TETRIS - 1985 RETRO</title>
    <style>
        body {
            background-color: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid #00ff00;
            padding: 20px;
            background-color: #001100;
        }

        .game-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .game-left {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-right {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 200px;
        }

        .title {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: normal;
            margin-bottom: 20px;
            color: #00ff00;
        }

        .game-board {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: normal;
            line-height: 1;
            white-space: pre;
            background-color: #000;
            border: 1px solid #00ff00;
            padding: 10px;
            display: inline-block;
            color: #00ff00;
        }

        .info {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: normal;
            color: #00ff00;
            text-align: left;
        }

        .controls {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: normal;
            color: #00ff00;
            text-align: left;
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Courier New', monospace;
            color: #00ff00;
            font-size: 16px;
            font-weight: normal;
            animation: blink 1s infinite;
            background-color: #001100;
            border: 2px solid #00ff00;
            padding: 20px;
            text-align: center;
            z-index: 1000;
        }

        @keyframes blink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0;
            }
        }

        /* 2025 Modern Style */
        .modern-style {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .modern-style .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            padding: 30px;
        }

        .modern-style .game-right {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modern-style .title {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            animation: gradientShift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            font-size: 24px;
            text-shadow: none;
            margin-bottom: 30px;
            font-family: 'Segoe UI', sans-serif;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .modern-style .game-board {
            background:
                linear-gradient(rgba(128, 128, 128, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(128, 128, 128, 0.2) 1px, transparent 1px),
                rgba(0, 0, 0, 0.9);
            background-size: 22px 22px, 22px 22px, auto;
            background-position: 10px 10px, 10px 10px, 0 0;
            border: 3px solid;
            border-image: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4) 1;
            border-radius: 15px;
            box-shadow:
                inset 0 0 30px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(255, 255, 255, 0.1),
                0 0 40px rgba(255, 107, 107, 0.3),
                0 0 60px rgba(69, 183, 209, 0.2);
            padding: 20px;
            font-size: 20px;
            line-height: 1.2;
            font-family: 'Segoe UI', sans-serif;
            position: relative;
        }

        .modern-style .game-board::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            animation: gradientShift 3s ease infinite;
            border-radius: 15px;
            z-index: -1;
        }

        .modern-style .info {
            color: #ffffff;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Segoe UI', sans-serif;
        }

        .modern-style .controls {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-family: 'Segoe UI', sans-serif;
        }

        .modern-style .game-over {
            color: #ff4757;
            text-shadow: 0 0 20px #ff4757;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #ff4757;
            box-shadow: 0 0 50px rgba(255, 71, 87, 0.5);
            font-family: 'Segoe UI', sans-serif;
        }

        /* Modern 3D Block Styles */
        .modern-block {
            width: 22px;
            height: 22px;
            position: relative;
            border-radius: 2px;
        }

        .modern-block::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 2px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 50%, rgba(0, 0, 0, 0.2) 100%);
        }

        .modern-block::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border-radius: 1px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.6), transparent 30%);
        }

        .modern-block-I {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 50%, #006699 100%);
            border: 1px solid #004d66;
            box-shadow:
                inset 1px 1px 0 rgba(255, 255, 255, 0.5),
                inset -1px -1px 0 rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-block-O {
            background: linear-gradient(135deg, #ffff33 0%, #cccc00 50%, #999900 100%);
            border: 1px solid #666600;
            box-shadow:
                inset 1px 1px 0 rgba(255, 255, 255, 0.5),
                inset -1px -1px 0 rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-block-T {
            background: linear-gradient(135deg, #ff66cc 0%, #cc3399 50%, #990066 100%);
            border: 1px solid #660033;
            box-shadow:
                inset 1px 1px 0 rgba(255, 255, 255, 0.5),
                inset -1px -1px 0 rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-block-S {
            background: linear-gradient(135deg, #33ff66 0%, #00cc33 50%, #009900 100%);
            border: 1px solid #006600;
            box-shadow:
                inset 1px 1px 0 rgba(255, 255, 255, 0.5),
                inset -1px -1px 0 rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-block-Z {
            background: linear-gradient(135deg, #ff3333 0%, #cc0000 50%, #990000 100%);
            border: 1px solid #660000;
            box-shadow:
                inset 1px 1px 0 rgba(255, 255, 255, 0.5),
                inset -1px -1px 0 rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-block-J {
            background: linear-gradient(135deg, #3366ff 0%, #0033cc 50%, #002299 100%);
            border: 1px solid #001166;
            box-shadow:
                inset 1px 1px 0 rgba(255, 255, 255, 0.5),
                inset -1px -1px 0 rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-block-L {
            background: linear-gradient(135deg, #ff9933 0%, #cc6600 50%, #994400 100%);
            border: 1px solid #662200;
            box-shadow:
                inset 1px 1px 0 rgba(255, 255, 255, 0.5),
                inset -1px -1px 0 rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-block-fixed {
            background: linear-gradient(135deg, #999999 0%, #666666 50%, #444444 100%);
            border: 1px solid #222222;
            box-shadow:
                inset 1px 1px 0 rgba(255, 255, 255, 0.3),
                inset -1px -1px 0 rgba(0, 0, 0, 0.5),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-border {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            animation: gradientShift 2s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
        }

        .modern-frame-corner {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.4));
        }

        .modern-frame-side {
            background: linear-gradient(90deg, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
            filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.3));
        }

        .modern-empty {
            width: 22px;
            height: 22px;
        }

        /* Modern Base Plate */
        .modern-base-plate {
            width: 100%;
            height: 8px;
            background: linear-gradient(135deg, #444444 0%, #666666 50%, #333333 100%);
            border: 1px solid #222222;
            border-radius: 0 0 8px 8px;
            box-shadow:
                inset 0 2px 0 rgba(255, 255, 255, 0.2),
                inset 0 -2px 0 rgba(0, 0, 0, 0.5),
                0 2px 8px rgba(0, 0, 0, 0.5);
            margin-top: 5px;
            position: relative;
        }

        .modern-base-plate::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), transparent 50%);
            border-radius: 0 0 8px 8px;
        }
    </style>
</head>

<body>
    <div class="game-container">
        <div class="title" id="gameTitle">
            ===============================================<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASCII TETRIS - 1985 <span id="retroToggle"
                style="cursor: pointer; text-decoration: underline;">RETRO</span><br>
            ===============================================
        </div>

        <div class="game-content">
            <div class="game-left">
                <div id="gameBoard" class="game-board"></div>
            </div>

            <div class="game-right">
                <div class="info">
                    <div>SCORE: <span id="score">000000</span></div>
                    <div>LEVEL: <span id="level">01</span></div>
                    <div>LINES: <span id="lines">000</span></div>
                </div>

                <div class="controls">
                    CONTROLS:<br>
                    ‚Üê ‚Üí - Move Left/Right<br>
                    ‚Üì - Soft Drop<br>
                    ‚Üë - Rotate<br>
                    SPACE - Hard Drop<br>
                    R - Restart<br>
                    ESC - Pause/Resume
                </div>
            </div>
        </div>

        <!-- Í≤åÏûÑ Ïò§Î≤Ñ Ïò§Î≤ÑÎ†àÏù¥ -->
        <div id="gameOverMsg" class="game-over" style="display: none;">
            ====================<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAME OVER!<br>
            ====================<br>
            Press R to restart<br>
            Press ESC to quit
        </div>
    </div>

    <script>
        class Tetris {
            constructor() {
                this.width = 10;
                this.height = 20;
                this.board = Array(this.height).fill().map(() => Array(this.width).fill(' '));
                this.pieceTypes = Array(this.height).fill().map(() => Array(this.width).fill(''));
                this.score = 0;
                this.level = 1;
                this.linesCleared = 0;
                this.currentPiece = null;
                this.currentX = 0;
                this.currentY = 0;
                this.currentRotation = 0;
                this.gameOver = false;
                this.paused = false;
                this.modernMode = false;

                // ÏÇ¨Ïö¥Îìú ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî
                this.audioContext = null;
                this.initAudio();

                // ÌÖåÌä∏Î¶¨Ïä§ Ï°∞Í∞ÅÎì§ (Ïò§Î¶¨ÏßÄÎÑê 7Í∞ú)
                this.pieces = {
                    'I': [['####']],
                    'O': [['##', '##']],
                    'T': [[' # ', '###']],
                    'S': [[' ##', '## ']],
                    'Z': [['## ', ' ##']],
                    'J': [['#  ', '###']],
                    'L': [['  #', '###']]
                };

                // Í∞Å Ï°∞Í∞ÅÏùò ÌöåÏ†Ñ ÏÉÅÌÉúÎì§
                this.rotations = {
                    'I': [['####'], ['#', '#', '#', '#']],
                    'O': [['##', '##']],
                    'T': [[' # ', '###'], ['# ', '##', '# '], ['###', ' # '], [' #', '##', ' #']],
                    'S': [[' ##', '## '], ['# ', '##', ' #']],
                    'Z': [['## ', ' ##'], [' #', '##', '# ']],
                    'J': [['#  ', '###'], ['##', '# ', '# '], ['###', '  #'], [' #', ' #', '##']],
                    'L': [['  #', '###'], ['# ', '# ', '##'], ['###', '#  '], ['##', ' #', ' #']]
                };

                this.spawnNewPiece();
                this.setupEventListeners();
                this.setupModeToggle();
                this.lastDropTime = Date.now();
                this.gameLoop();
            }

            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Web Audio API not supported');
                }
            }

            playRetroSound(frequency = 800, duration = 100) {
                if (!this.audioContext) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'square'; // 8ÎπÑÌä∏ Ïä§ÌÉÄÏùº

                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration / 1000);

                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration / 1000);
            }

            playModernSound(type = 'move', param = null) {
                if (!this.audioContext) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                const filter = this.audioContext.createBiquadFilter();

                oscillator.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                if (type === 'move') {
                    // Î∂ÄÎìúÎü¨Ïö¥ Ïù¥Îèô ÏÇ¨Ïö¥Îìú
                    oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(660, this.audioContext.currentTime + 0.1);
                    oscillator.type = 'sine';
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(2000, this.audioContext.currentTime);
                } else if (type === 'rotate') {
                    // ÌöåÏ†Ñ ÏÇ¨Ïö¥Îìú
                    oscillator.frequency.setValueAtTime(330, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(880, this.audioContext.currentTime + 0.15);
                    oscillator.type = 'triangle';
                    filter.type = 'bandpass';
                    filter.frequency.setValueAtTime(1000, this.audioContext.currentTime);
                } else if (type === 'drop') {
                    // ÎìúÎ°≠ ÏÇ¨Ïö¥Îìú
                    oscillator.frequency.setValueAtTime(880, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(220, this.audioContext.currentTime + 0.3);
                    oscillator.type = 'sawtooth';
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(1500, this.audioContext.currentTime);
                } else if (type === 'land') {
                    // Î∏îÎü≠ Ï∞©ÏßÄ ÏÇ¨Ïö¥Îìú
                    oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, this.audioContext.currentTime + 0.2);
                    oscillator.type = 'triangle';
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(800, this.audioContext.currentTime);
                } else if (type === 'lineClear') {
                    // ÎùºÏù∏ ÌÅ¥Î¶¨Ïñ¥ ÏÇ¨Ïö¥Îìú (ÎùºÏù∏ ÏàòÏóê Îî∞Îùº Îã§Î¶Ñ)
                    const lines = param || 1;
                    const baseFreq = 523; // C5
                    oscillator.frequency.setValueAtTime(baseFreq, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(baseFreq * (1 + lines * 0.5), this.audioContext.currentTime + 0.4);
                    oscillator.type = 'sine';
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(3000, this.audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                } else if (type === 'gameOver') {
                    // Í≤åÏûÑ Ïò§Î≤Ñ ÏÇ¨Ïö¥Îìú
                    oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(110, this.audioContext.currentTime + 1.0);
                    oscillator.type = 'sawtooth';
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(1000, this.audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.08, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 1.0);
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + 1.0);
                    return;
                }

                gainNode.gain.setValueAtTime(0.05, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);

                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + 0.3);
            }

            playSound(action, param = null) {
                // ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö© ÌõÑ Ïò§ÎîîÏò§ Ïª®ÌÖçÏä§Ìä∏ Ïû¨Í∞ú
                if (this.audioContext && this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }

                if (this.modernMode) {
                    this.playModernSound(action, param);
                } else {
                    // Î†àÌä∏Î°ú Î™®Îìú - 8ÎπÑÌä∏ ÏÇëÏÇë ÏÜåÎ¶¨
                    if (action === 'move') {
                        this.playRetroSound(800, 80);
                    } else if (action === 'rotate') {
                        this.playRetroSound(1000, 100);
                    } else if (action === 'drop') {
                        this.playRetroSound(600, 150);
                    } else if (action === 'land') {
                        this.playRetroSound(400, 120);
                    } else if (action === 'lineClear') {
                        const lines = param || 1;
                        // ÎùºÏù∏ ÏàòÏóê Îî∞Îùº Îã§Î•∏ Ï£ºÌååÏàò
                        for (let i = 0; i < lines; i++) {
                            setTimeout(() => {
                                this.playRetroSound(1200 + i * 200, 150);
                            }, i * 100);
                        }
                    } else if (action === 'gameOver') {
                        // Í≤åÏûÑ Ïò§Î≤Ñ - ÌïòÍ∞ïÌïòÎäî ÏÇëÏÇë ÏÜåÎ¶¨
                        for (let i = 0; i < 5; i++) {
                            setTimeout(() => {
                                this.playRetroSound(800 - i * 100, 200);
                            }, i * 150);
                        }
                    }
                }
            }

            setupModeToggle() {
                document.getElementById('retroToggle').addEventListener('click', () => {
                    this.modernMode = !this.modernMode;
                    this.toggleMode();
                });
            }

            toggleMode() {
                const body = document.body;
                const retroToggle = document.getElementById('retroToggle');
                const gameTitle = document.getElementById('gameTitle');

                if (this.modernMode) {
                    body.classList.add('modern-style');
                    retroToggle.textContent = 'MODERN';
                    gameTitle.innerHTML = `
                        <div style="font-size: 42px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 15px;">
                            <img src="tetris.svg" width="48" height="48" alt="Tetris Icon" style="filter: drop-shadow(0 3px 6px rgba(0,0,0,0.3));">
                            TETRIS <span id="retroToggle" style="cursor: pointer; text-decoration: underline;">2025</span>
                        </div>
                        <div style="font-size: 24px; opacity: 0.8;">
                            Next-Gen Gaming Experience
                        </div>
                    `;
                    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îã§Ïãú Ïó∞Í≤∞
                    document.getElementById('retroToggle').addEventListener('click', () => {
                        this.modernMode = !this.modernMode;
                        this.toggleMode();
                    });
                } else {
                    body.classList.remove('modern-style');
                    retroToggle.textContent = 'RETRO';
                    gameTitle.innerHTML = `
                        ===============================================<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASCII TETRIS - 1985 <span id="retroToggle"
                            style="cursor: pointer; text-decoration: underline;">RETRO</span><br>
                        ===============================================
                    `;
                    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îã§Ïãú Ïó∞Í≤∞
                    document.getElementById('retroToggle').addEventListener('click', () => {
                        this.modernMode = !this.modernMode;
                        this.toggleMode();
                    });
                }

                this.updateDisplay();
            }

            spawnNewPiece() {
                const pieceTypes = Object.keys(this.pieces);
                this.currentPiece = pieceTypes[Math.floor(Math.random() * pieceTypes.length)];
                this.currentRotation = 0;
                this.currentX = Math.floor(this.width / 2) - 1;
                this.currentY = 0;

                // Í≤åÏûÑ Ïò§Î≤Ñ Ï≤¥ÌÅ¨
                if (this.checkCollision()) {
                    this.gameOver = true;
                    this.playSound('gameOver');
                }
            }

            getCurrentShape() {
                return this.rotations[this.currentPiece][this.currentRotation];
            }

            checkCollision(dx = 0, dy = 0, rotation = null) {
                if (rotation === null) rotation = this.currentRotation;

                const shape = this.rotations[this.currentPiece][rotation];

                for (let y = 0; y < shape.length; y++) {
                    for (let x = 0; x < shape[y].length; x++) {
                        if (shape[y][x] === '#') {
                            const newX = this.currentX + x + dx;
                            const newY = this.currentY + y + dy;

                            if (newX < 0 || newX >= this.width ||
                                newY >= this.height ||
                                (newY >= 0 && this.board[newY][newX] !== ' ')) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }

            placePiece() {
                const shape = this.getCurrentShape();

                for (let y = 0; y < shape.length; y++) {
                    for (let x = 0; x < shape[y].length; x++) {
                        if (shape[y][x] === '#') {
                            const boardX = this.currentX + x;
                            const boardY = this.currentY + y;
                            if (boardY >= 0) {
                                this.board[boardY][boardX] = '#';
                                this.pieceTypes[boardY][boardX] = this.currentPiece;
                            }
                        }
                    }
                }

                this.clearLines();
                this.spawnNewPiece();
            }

            clearLines() {
                const linesToClear = [];

                for (let y = 0; y < this.height; y++) {
                    if (this.board[y].every(cell => cell !== ' ')) {
                        linesToClear.push(y);
                    }
                }

                if (linesToClear.length > 0) {
                    // ÎùºÏù∏ ÌÅ¥Î¶¨Ïñ¥ Ïï†ÎãàÎ©îÏù¥ÏÖò (Î†àÌä∏Î°ú Ïä§ÌÉÄÏùº)
                    this.animateLineClear(linesToClear, () => {
                        // ÎùºÏù∏ Ï†úÍ±∞ Î∞è Ï†êÏàò Í≥ÑÏÇ∞
                        for (let i = linesToClear.length - 1; i >= 0; i--) {
                            this.board.splice(linesToClear[i], 1);
                            this.board.unshift(Array(this.width).fill(' '));
                            this.pieceTypes.splice(linesToClear[i], 1);
                            this.pieceTypes.unshift(Array(this.width).fill(''));
                        }

                        this.linesCleared += linesToClear.length;
                        // Ïò§Î¶¨ÏßÄÎÑê ÌÖåÌä∏Î¶¨Ïä§ Ï†êÏàò ÏãúÏä§ÌÖú
                        const scoreTable = { 1: 40, 2: 100, 3: 300, 4: 1200 };
                        this.score += (scoreTable[linesToClear.length] || 0) * (this.level + 1);
                        this.level = Math.min(10, Math.floor(this.linesCleared / 10) + 1);

                        // ÎùºÏù∏ ÌÅ¥Î¶¨Ïñ¥ ÏÇ¨Ïö¥Îìú
                        this.playSound('lineClear', linesToClear.length);

                        this.updateDisplay();
                    });
                }
            }

            animateLineClear(lines, callback) {
                let blinkCount = 0;
                const maxBlinks = 6;

                const blink = () => {
                    for (let y of lines) {
                        for (let x = 0; x < this.width; x++) {
                            this.board[y][x] = blinkCount % 2 === 0 ? '=' : ' ';
                        }
                    }
                    this.updateDisplay();

                    blinkCount++;
                    if (blinkCount < maxBlinks) {
                        setTimeout(blink, 100);
                    } else {
                        callback();
                    }
                };

                blink();
            }

            moveLeft() {
                if (!this.checkCollision(-1, 0)) {
                    this.currentX--;
                    this.playSound('move');
                }
            }

            moveRight() {
                if (!this.checkCollision(1, 0)) {
                    this.currentX++;
                    this.playSound('move');
                }
            }

            moveDown() {
                if (!this.checkCollision(0, 1)) {
                    this.currentY++;
                    return true;
                } else {
                    this.placePiece();
                    this.playSound('land'); // Î∏îÎü≠Ïù¥ Î∞îÎã•Ïóê Îñ®Ïñ¥Ï°åÏùÑ Îïå
                    return false;
                }
            }

            rotate() {
                const maxRotations = this.rotations[this.currentPiece].length;
                const newRotation = (this.currentRotation + 1) % maxRotations;

                if (!this.checkCollision(0, 0, newRotation)) {
                    this.currentRotation = newRotation;
                    this.playSound('rotate');
                }
            }

            hardDrop() {
                while (this.moveDown()) {
                    this.score += 2; // ÌïòÎìú ÎìúÎ°≠ Î≥¥ÎÑàÏä§
                }
                this.playSound('drop');
            }

            getDisplayBoard() {
                const displayBoard = this.board.map(row => [...row]);
                const pieceBoard = this.pieceTypes.map(row => [...row]);

                if (!this.gameOver) {
                    const shape = this.getCurrentShape();
                    for (let y = 0; y < shape.length; y++) {
                        for (let x = 0; x < shape[y].length; x++) {
                            if (shape[y][x] === '#') {
                                const boardX = this.currentX + x;
                                const boardY = this.currentY + y;
                                if (boardX >= 0 && boardX < this.width &&
                                    boardY >= 0 && boardY < this.height) {
                                    displayBoard[boardY][boardX] = '#';
                                    pieceBoard[boardY][boardX] = this.currentPiece;
                                }
                            }
                        }
                    }
                }

                return { displayBoard, pieceBoard };
            }

            updateDisplay() {
                const { displayBoard, pieceBoard } = this.getDisplayBoard();
                const gameBoard = document.getElementById('gameBoard');

                if (this.modernMode) {
                    // Î™®Îçò Î™®Îìú: CSS GridÎ°ú ÏôÑÎ≤ΩÌïú Ï†ïÎ†¨ + Î∞îÎã• ÌîåÎ†àÏù¥Ìä∏
                    let boardHTML = `<div style="padding: 10px; display: flex; flex-direction: column; align-items: center;">`;

                    // Í≤åÏûÑ Î≥¥Îìú Grid
                    boardHTML += `<div style="display: grid; grid-template-columns: repeat(${this.width}, 22px); grid-template-rows: repeat(${this.height}, 22px); gap: 0;">`;

                    // Í≤åÏûÑ Î≥¥Îìú - GridÎ°ú ÏôÑÎ≤Ω Ï†ïÎ†¨
                    for (let y = 0; y < this.height; y++) {
                        for (let x = 0; x < this.width; x++) {
                            const cell = displayBoard[y][x];
                            const piece = pieceBoard[y][x];

                            if (cell === '#' && piece) {
                                boardHTML += `<div class="modern-block modern-block-${piece}"></div>`;
                            } else if (cell === '#') {
                                boardHTML += `<div class="modern-block modern-block-fixed"></div>`;
                            } else if (cell === '=') {
                                // ÎùºÏù∏ ÌÅ¥Î¶¨Ïñ¥ Ïï†ÎãàÎ©îÏù¥ÏÖò
                                boardHTML += `<div class="modern-block" style="background: linear-gradient(45deg, #fff, #ccc); animation: pulse 0.1s infinite;"></div>`;
                            } else {
                                boardHTML += `<div class="modern-empty"></div>`;
                            }
                        }
                    }

                    boardHTML += '</div>';

                    // Î∞îÎã• ÌîåÎ†àÏù¥Ìä∏ Ï∂îÍ∞Ä
                    boardHTML += `<div class="modern-base-plate" style="width: ${this.width * 22}px;"></div>`;

                    boardHTML += '</div>';
                    gameBoard.innerHTML = boardHTML;
                } else {
                    // Î†àÌä∏Î°ú Î™®Îìú: Í∏∞Ï°¥ ÌÖçÏä§Ìä∏ Î∞©Ïãù
                    let boardStr = '  +' + '-'.repeat(this.width) + '+\n';

                    for (let row of displayBoard) {
                        boardStr += '  |' + row.join('') + '|\n';
                    }
                    boardStr += '  +' + '-'.repeat(this.width) + '+';
                    gameBoard.textContent = boardStr;
                }

                document.getElementById('score').textContent = this.score.toString().padStart(6, '0');
                document.getElementById('level').textContent = this.level.toString().padStart(2, '0');
                document.getElementById('lines').textContent = this.linesCleared.toString().padStart(3, '0');

                const gameOverMsg = document.getElementById('gameOverMsg');
                if (this.gameOver) {
                    gameOverMsg.style.display = 'block';
                    if (this.modernMode) {
                        gameOverMsg.innerHTML = `
                            <div style="font-size: 32px; margin-bottom: 15px;">üíÄ GAME OVER</div>
                            <div style="font-size: 18px; margin-bottom: 10px;">Final Score: ${this.score}</div>
                            <div style="font-size: 16px; opacity: 0.8;">Press R: Restart ‚Ä¢ ESC: Quit</div>
                        `;
                    } else {
                        gameOverMsg.innerHTML = `
                            ====================<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GAME OVER!<br>
                            ====================<br>
                            Press R to restart<br>
                            Press ESC to quit
                        `;
                    }
                } else {
                    gameOverMsg.style.display = 'none';
                }
            }

            setupEventListeners() {
                document.addEventListener('keydown', (e) => {
                    if (this.gameOver) {
                        if (e.key === 'r' || e.key === 'R') {
                            this.restart();
                        }
                        return;
                    }

                    if (this.paused && e.key !== 'Escape') return;

                    switch (e.key) {
                        case 'ArrowLeft':
                            e.preventDefault();
                            this.moveLeft();
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            this.moveRight();
                            break;
                        case 'ArrowDown':
                            e.preventDefault();
                            this.moveDown();
                            this.lastDropTime = Date.now();
                            break;
                        case 'ArrowUp':
                            e.preventDefault();
                            this.rotate();
                            break;
                        case ' ':
                            e.preventDefault();
                            this.hardDrop();
                            this.lastDropTime = Date.now();
                            break;
                        case 'Escape':
                            this.paused = !this.paused;
                            break;
                        case 'r':
                        case 'R':
                            if (this.gameOver) {
                                this.restart();
                            }
                            break;
                    }

                    this.updateDisplay();
                });
            }

            restart() {
                this.board = Array(this.height).fill().map(() => Array(this.width).fill(' '));
                this.pieceTypes = Array(this.height).fill().map(() => Array(this.width).fill(''));
                this.score = 0;
                this.level = 1;
                this.linesCleared = 0;
                this.gameOver = false;
                this.paused = false;
                this.spawnNewPiece();
                this.lastDropTime = Date.now();
                this.updateDisplay();
            }

            gameLoop() {
                if (!this.gameOver && !this.paused) {
                    const currentTime = Date.now();
                    // Î†àÎ≤®Ïóê Îî∞Î•∏ ÎÇôÌïò ÏÜçÎèÑ (1985ÎÖÑ Ïò§Î¶¨ÏßÄÎÑê Ïä§ÌÉÄÏùº)
                    const dropInterval = Math.max(100, 1000 - (this.level - 1) * 100);

                    if (currentTime - this.lastDropTime > dropInterval) {
                        this.moveDown();
                        this.lastDropTime = currentTime;
                    }

                    this.updateDisplay();
                }

                // Î†àÌä∏Î°ú ÎäêÎÇåÏùÑ ÏúÑÌïú ÌîÑÎ†àÏûÑ Ï†úÌïú (50ms = 20fps)
                setTimeout(() => this.gameLoop(), 50);
            }
        }

        // Í≤åÏûÑ ÏãúÏûë
        window.addEventListener('load', () => {
            new Tetris();
        });
    </script>
</body>

</html>